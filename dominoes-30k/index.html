


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Derived data, flowing">
      
      
        <link rel="canonical" href="https://day8.github.io/re-frame/dominoes-30k/">
      
      
        <meta name="author" content="Mike Thompson">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.9">
    
    
    
    <title>Code</title>
    

    
      <link rel="stylesheet" href="../assets/stylesheets/main.36ee6aaa.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.83bccb1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#2094f3">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,300;0,500;1,400&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@200;300;400&display=swap">
    
      <link rel="stylesheet" href="../stylesheets/dominoes-live.css">
    
      <link rel="stylesheet" href="../stylesheets/mkdocs.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://day8.github.io/re-frame/"
      title="re-frame"
      class="md-header-nav__button md-logo"
      aria-label="re-frame"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            re-frame
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Code
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/day8/re-frame/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    day8/re-frame
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../re-frame/" class="md-tabs__link md-tabs__link--active">
          Docs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../FAQs/Inspecting-app-db/" class="md-tabs__link">
          FAQs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../api-intro/" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../releases/2024/" class="md-tabs__link">
          Releases
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../External-Resources/" class="md-tabs__link">
          Resources
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://day8.github.io/re-frame/" title="re-frame" class="md-nav__button md-logo" aria-label="re-frame">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>

    </a>
    re-frame
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/day8/re-frame/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    day8/re-frame
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Docs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Docs" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../re-frame/" title="re-frame" class="md-nav__link">
      re-frame
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      THE BASICS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="THE BASICS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        THE BASICS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a-loop/" title="A Data Loop" class="md-nav__link">
      A Data Loop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application-state/" title="State" class="md-nav__link">
      State
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Code
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Code" class="md-nav__link md-nav__link--active">
      Code
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-setup" class="md-nav__link">
    The Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-1-event-dispatch" class="md-nav__link">
    Domino 1 - Event Dispatch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-2-event-handling" class="md-nav__link">
    Domino 2 - Event Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-3-effect-handling" class="md-nav__link">
    Domino 3 - Effect Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-4-query" class="md-nav__link">
    Domino 4 - Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-5-view" class="md-nav__link">
    Domino 5 - View
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-6-dom" class="md-nav__link">
    Domino 6 - DOM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-4-5-6-summary" class="md-nav__link">
    3-4-5-6 Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aaaaand-were-done" class="md-nav__link">
    Aaaaand we're done
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-sub-cascades" class="md-nav__link">
    Two Sub-Cascades
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event-handling-infographic/" title="Infographics" class="md-nav__link">
      Infographics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../subscriptions/" title="Subscriptions" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dominoes-live/" title="Live" class="md-nav__link">
      Live
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      INTERMEDIATE 2 & 3
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="INTERMEDIATE 2 & 3" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        INTERMEDIATE 2 & 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../EffectfulHandlers/" title="Effectful Handlers" class="md-nav__link">
      Effectful Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Interceptors/" title="Interceptors" class="md-nav__link">
      Interceptors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Effects/" title="Effects" class="md-nav__link">
      Effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Coeffects/" title="Coeffects" class="md-nav__link">
      Coeffects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Flows/" title="Flows" class="md-nav__link">
      Flows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../review-todomvc/" title="Review TodoMVC" class="md-nav__link">
      Review TodoMVC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      INTERMEDIATE 4,5 & 6
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="INTERMEDIATE 4,5 & 6" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        INTERMEDIATE 4,5 & 6
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../correcting-a-wrong/" title="Correcting a wrong" class="md-nav__link">
      Correcting a wrong
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flow-mechanics/" title="Flow Mechanics" class="md-nav__link">
      Flow Mechanics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../start-coding/" title="START CODING" class="md-nav__link">
      START CODING
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      MENTAL MODEL OMNIBUS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="MENTAL MODEL OMNIBUS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        MENTAL MODEL OMNIBUS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../all-models-are-wrong/" title="Other Models" class="md-nav__link">
      Other Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../on-dynamics/" title="On Dynamics" class="md-nav__link">
      On Dynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-oriented-design/" title="Data Oriented Design" class="md-nav__link">
      Data Oriented Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interconnections/" title="Interconnections" class="md-nav__link">
      Interconnections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../historical/" title="Historical" class="md-nav__link">
      Historical
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      MORE ADVANCED
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="MORE ADVANCED" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        MORE ADVANCED
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../flows-advanced-topics/" title="Flows - advanced topics" class="md-nav__link">
      Flows - advanced topics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../on-stable-dom-handlers/" title="Stable Dom Handlers" class="md-nav__link">
      Stable Dom Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../browser-dynamics/" title="Browser Dynamics" class="md-nav__link">
      Browser Dynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reusable-components/" title="Reusable Components" class="md-nav__link">
      Reusable Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../App-Structure/" title="App Structure" class="md-nav__link">
      App Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Loading-Initial-Data/" title="Loading Initial Data" class="md-nav__link">
      Loading Initial Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Talking-To-Servers/" title="Talking To Servers" class="md-nav__link">
      Talking To Servers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Subscribing-To-External-Data/" title="Subscribing to External Data" class="md-nav__link">
      Subscribing to External Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Debugging/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Performance-Problems/" title="Eek! Performance Problems" class="md-nav__link">
      Eek! Performance Problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solve-the-CPU-hog-problem/" title="Solve the CPU hog problem" class="md-nav__link">
      Solve the CPU hog problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Using-Stateful-JS-Components/" title="Using Stateful JS Components" class="md-nav__link">
      Using Stateful JS Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../The-re-frame-logo/" title="The Logo Backstory" class="md-nav__link">
      The Logo Backstory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      FAQs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="FAQs" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        FAQs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Inspecting-app-db/" title="How can I Inspect app-db?" class="md-nav__link">
      How can I Inspect app-db?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/BestPractice/" title="What Is Best Practice?" class="md-nav__link">
      What Is Best Practice?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/LoadOnMount/" title="How Do I Load On Mount?" class="md-nav__link">
      How Do I Load On Mount?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/DoINeedReFrame/" title="Reagent looks terrific. Why do I need re-frame?" class="md-nav__link">
      Reagent looks terrific. Why do I need re-frame?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/FocusOnElement/" title="How to focus on an HTML element" class="md-nav__link">
      How to focus on an HTML element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/GlobalInterceptors/" title="How do I register a global interceptor" class="md-nav__link">
      How do I register a global interceptor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/laggy-input/" title="Why is my input field laggy?" class="md-nav__link">
      Why is my input field laggy?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/When-Does-Dispatch-Happen/" title="How long after I do a dispatch does the event get handled?" class="md-nav__link">
      How long after I do a dispatch does the event get handled?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/UseASubscriptionInAnEventHandler/" title="How can I use a subscription in an Event Handler" class="md-nav__link">
      How can I use a subscription in an Event Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/use-cofx-as-fx/" title="Why can't I turn a `cofx` map into an `fx` map?" class="md-nav__link">
      Why can't I turn a `cofx` map into an `fx` map?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Logging/" title="How do I use logging method X" class="md-nav__link">
      How do I use logging method X
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Null-Dispatched-Events/" title="Dispatched Events Are Null" class="md-nav__link">
      Dispatched Events Are Null
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Why-Clear-Sub-Cache/" title="Why do we need to clear the subscription cache when reloading with Figwheel?" class="md-nav__link">
      Why do we need to clear the subscription cache when reloading with Figwheel?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/PollADatabaseEvery60/" title="How do I turn on/off polling a database every 60 secs" class="md-nav__link">
      How do I turn on/off polling a database every 60 secs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/ViewsOnGlobalRegistration/" title="re-frame uses side-effecting registrations. Should I feel dirty?" class="md-nav__link">
      re-frame uses side-effecting registrations. Should I feel dirty?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Why-CLJC/" title="Why is re-frame implemented in `.cljc` files" class="md-nav__link">
      Why is re-frame implemented in `.cljc` files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/DB_Normalisation/" title="How do I store normalised data in app-db?" class="md-nav__link">
      How do I store normalised data in app-db?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/FullStackReframe/" title="How do I do full-stack re-frame?" class="md-nav__link">
      How do I do full-stack re-frame?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api-intro/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-builtin-effects/" title="Builtin Effects" class="md-nav__link">
      Builtin Effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-re-frame.core/" title="re-frame.core" class="md-nav__link">
      re-frame.core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-re-frame.alpha/" title="re-frame.alpha" class="md-nav__link">
      re-frame.alpha
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Releases
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Releases" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2024/" title="2024" class="md-nav__link">
      2024
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2023/" title="2023" class="md-nav__link">
      2023
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2022/" title="2022" class="md-nav__link">
      2022
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2021/" title="2021" class="md-nav__link">
      2021
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2020/" title="2020" class="md-nav__link">
      2020
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2019/" title="2019" class="md-nav__link">
      2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2018/" title="2018" class="md-nav__link">
      2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2017/" title="2017" class="md-nav__link">
      2017
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2016/" title="2016" class="md-nav__link">
      2016
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2015/" title="2015" class="md-nav__link">
      2015
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Resources
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Resources" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../External-Resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-setup" class="md-nav__link">
    The Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-1-event-dispatch" class="md-nav__link">
    Domino 1 - Event Dispatch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-2-event-handling" class="md-nav__link">
    Domino 2 - Event Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-3-effect-handling" class="md-nav__link">
    Domino 3 - Effect Handling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-4-query" class="md-nav__link">
    Domino 4 - Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-5-view" class="md-nav__link">
    Domino 5 - View
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domino-6-dom" class="md-nav__link">
    Domino 6 - DOM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-4-5-6-summary" class="md-nav__link">
    3-4-5-6 Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aaaaand-were-done" class="md-nav__link">
    Aaaaand we're done
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#two-sub-cascades" class="md-nav__link">
    Two Sub-Cascades
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/day8/re-frame/edit/master/docs/dominoes-30k.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>Code</h1>
                
                <p>Previously, we looked at the dominoes from 60,000 feet. We will now shift 
down to 30,000 feet and look in more detail, this time with code fragments.</p>
<p><img align="right" width="360px" src="../images/Readme/todolist.png"></p>
<h2 id="the-setup">The Setup<a class="headerlink" href="#the-setup" title="Permanent link">&para;</a></h2>
<p>Imagine this: our app displays a list of items. </p>
<p>The user clicks the "delete" button next to the 3rd item in the list.</p>
<p>In response, let's track what happens within our imaginary re-frame app? Let's manually step through
the resulting six domino cascade.</p>
<div class="admonition note">
<p>Don't expect 
to completely grok the terse code presented below. We're still at 30,000 feet. More details later. </p>
</div>
<h2 id="domino-1-event-dispatch">Domino 1 - Event Dispatch<a class="headerlink" href="#domino-1-event-dispatch" title="Permanent link">&para;</a></h2>
<p>In order for it to be clicked, that 3rd delete button must have already been rendered. And rendering 
in re-frame is done by a <code>ViewFunction</code>. Perhaps it was rendered like this: </p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defn </span><span class="nv">delete-button</span> 
  <span class="p">[</span><span class="nv">item-id</span><span class="p">]</span>
  <span class="p">[</span><span class="ss">:div.garbage-bin</span> 
    <span class="ss">:on-click</span> <span class="o">#</span><span class="p">(</span><span class="nf">re-frame.core/dispatch</span> <span class="p">[</span><span class="ss">:delete-item</span> <span class="nv">item-id</span><span class="p">])])</span>
</code></pre></div>


<p>It is that <code>on-click</code> handler (function) which interests us. When the user clicks on the garbage-bin icon, that function is called. </p>
<div class="codehilite"><pre><span></span><code><span class="o">#</span><span class="p">(</span><span class="nf">re-frame.core/dispatch</span> <span class="p">[</span><span class="ss">:delete-item</span> <span class="nv">item-id</span><span class="p">])</span>
</code></pre></div>


<p>This function calls re-frame's <code>dispatch</code> to emit an <code>event</code>.</p>
<p>Every re-frame <code>event</code> is a vector and, in this case, the dispatched <code>event</code> has two elements: </p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="ss">:delete-item</span> <span class="mi">2486</span><span class="p">]</span>
</code></pre></div>


<p>where <code>2486</code> is an <code>id</code> I just made up for that 3rd item.  </p>
<p>The first element of an event vector,
<code>:delete-item</code>, is the kind of event. The rest is optional data, salient to the 
<code>event</code>.</p>
<p>Events express user intent in a domain-specific way.
They are the language of your re-frame system. </p>
<h2 id="domino-2-event-handling">Domino 2 - Event Handling<a class="headerlink" href="#domino-2-event-handling" title="Permanent link">&para;</a></h2>
<p>An <code>event handler</code> (function), which we'll name <code>h</code>, is now called to 
compute the <code>effect</code> of the event <code>[:delete-item 2486]</code>.</p>
<p>On startup, re-frame apps register handlers for events using <code>reg-event-fx</code>. So,
in our imaginary app, because <code>h</code> is the handler function for <code>:delete-item</code> events, 
it must have been registered like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">re-frame.core/reg-event-fx</span>   <span class="c1">;; a part of the re-frame API</span>
  <span class="ss">:delete-item</span>                <span class="c1">;; the kind of event</span>
  <span class="nv">h</span><span class="p">)</span>                          <span class="c1">;; the handler function for this kind of event</span>
</code></pre></div>


<p>Because <code>h</code> is an event handler, it is written to take two arguments:</p>
<ol>
<li>a <code>coeffects</code> map. This data describes the current state of "the world". In the simplest case, it is a trivial map like this: <code>{:db a-value}</code> where <code>a-value</code> is the current application state held in <code>app-db</code>. </li>
<li>the <code>event</code> to handle, which would be <code>[:delete-item 2486]</code> in this case.</li>
</ol>
<p><code>h</code> will compute effects as data. That means: it computes how the world should be changed 
by the event, and it returns a map of <code>effects</code> which describe the necessary changes.</p>
<p>Here's a sketch (we are at 30,000 feet):</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defn </span><span class="nv">h</span>                          <span class="c1">;; maybe choose a better name like `delete-item`</span>
 <span class="p">[</span><span class="nv">coeffects</span> <span class="nv">event</span><span class="p">]</span>               <span class="c1">;; `coeffects` holds the current state of the world</span>
 <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">item-id</span>  <span class="p">(</span><span class="nb">second </span><span class="nv">event</span><span class="p">)</span>   <span class="c1">;; extract id from event vector</span>
       <span class="nv">db</span>       <span class="p">(</span><span class="ss">:db</span> <span class="nv">coeffects</span><span class="p">)</span>  <span class="c1">;; extract the current application state</span>
       <span class="nv">new-db</span>   <span class="p">(</span><span class="nf">dissoc-in</span> <span class="nv">db</span> <span class="p">[</span><span class="ss">:items</span> <span class="nv">item-id</span><span class="p">])]</span>   <span class="c1">;; new app state</span>
   <span class="p">{</span><span class="ss">:db</span> <span class="nv">new-db</span><span class="p">}))</span>                <span class="c1">;; a map of the necessary effects </span>
</code></pre></div>


<p>There are ways (described in later tutorials) for you to inject necessary aspects
of "the world" into that first <code>coeffects</code> argument (map). Different
event handlers need to know different "things" about the world to do their job. But 
current "application state" is one aspect of the world which is 
invariably needed, and it is available by default in the <code>:db</code> key. So 
the current value in <code>app-db</code> is available via the expression <code>(:db coeffects)</code>.</p>
<p>The value returned by <code>h</code> is a map with only one key, like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="ss">:db</span> <span class="nv">new-db</span><span class="p">}</span>     <span class="c1">;; `new-db` is the newly computed application state</span>
</code></pre></div>


<p>So, <code>h</code> computes one effect, and returns it. And that effect says to make a change to 
application state.</p>
<p>Please pay particular attention to this overall flow, within <code>h</code>:</p>
<ol>
<li><code>h</code> obtains the current application state (a map) via <code>(:db coeffects)</code> </li>
<li>it computes a modified application state via <code>(dissoc-in db [:items item-id])</code></li>
<li>it returns this modified application state in an effects map <code>{:db new-db}</code></li>
</ol>
<p>BTW, here is a more idiomatic (and terser) rewrite of <code>h</code> using <a href="https://clojure.org/guides/destructuring">destructuring</a> of the args: </p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defn </span><span class="nv">h</span> 
  <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">db</span><span class="p">]}</span> <span class="p">[</span><span class="nv">_</span> <span class="nv">item-id</span><span class="p">]]</span>    <span class="c1">;; &lt;--- new: obtain db and item-id directly</span>
  <span class="p">{</span><span class="ss">:db</span>  <span class="p">(</span><span class="nf">dissoc-in</span> <span class="nv">db</span> <span class="p">[</span><span class="ss">:items</span> <span class="nv">item-id</span><span class="p">])})</span>    <span class="c1">;; </span>
</code></pre></div>


<h2 id="domino-3-effect-handling">Domino 3 - Effect Handling<a class="headerlink" href="#domino-3-effect-handling" title="Permanent link">&para;</a></h2>
<p><code>effect handler</code> functions action the <code>effects</code> returned by <code>h</code>.</p>
<p>In Domino 2, <code>h</code> returned: </p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="ss">:db</span>  <span class="nv">new-db</span><span class="p">}</span>   <span class="c1">;; `new-db` is the new, computed application state</span>
</code></pre></div>


<p>Each key of this returned map identifies one kind 
of <code>effect</code>, and the value for that key supplies further details. 
The map returned by <code>h</code> only has one key, <code>:db</code>, so it is specifying only one effect.</p>
<p>On startup, a re-frame app can register <code>effects handlers</code> using <code>reg-fx</code>. For example, 
the effect handler function for the <code>:db</code> effect could be registered like this: </p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">re-frame.core/reg-fx</span>       <span class="c1">;; part of the re-frame API</span>
  <span class="ss">:db</span>                       <span class="c1">;; the effects key </span>
  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">val</span><span class="p">]</span>                 <span class="c1">;; the handler function for the effect</span>
    <span class="p">(</span><span class="nf">reset!</span> <span class="nv">app-db</span> <span class="nv">val</span><span class="p">)))</span>   <span class="c1">;; put the new value into the ratom app-db</span>
</code></pre></div>


<p>Just to be clear, this <code>reset!</code> of <code>app-db</code> is a mutative, effectful action. That's
what effect handlers do. They change the world. They are not pure functions.</p>
<p>Now, you don't need to ever register an effects handler for <code>:db</code>
because re-frame supplies one built in. re-frame manages <code>app-db</code> and so it 
will look for any changes (effects) to it.</p>
<p>But if, instead, <code>h</code> had returned: </p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="ss">:wear</span>  <span class="p">{</span><span class="ss">:pants</span> <span class="s">&quot;velour flares&quot;</span>  <span class="ss">:belt</span> <span class="nv">false</span><span class="p">}</span>
 <span class="ss">:tweet</span> <span class="s">&quot;Okay, yes, I am Satoshi. #coverblown&quot;</span><span class="p">}</span>
</code></pre></div>


<p>Then, the two effects handlers registered for <code>:wear</code> and <code>:tweet</code> would 
be called to action those two effects. And, no, re-frame 
does not supply standard effect handlers for either, so you would need to have
written them yourself, and then registered them. </p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">re-frame.core/reg-fx</span>    <span class="c1">;; re-frame API</span>
  <span class="ss">:wear</span>        <span class="c1">;; the effects key which this handler can action</span>
  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">val</span><span class="p">]</span>    <span class="c1">;; val would be, eg, {:pants &quot;velour flares&quot;  :belt false}</span>
    <span class="nv">...</span><span class="p">))</span>      <span class="c1">;; do what&#39;s necessary to action the side effect</span>
</code></pre></div>


<h2 id="domino-4-query">Domino 4 - Query<a class="headerlink" href="#domino-4-query" title="Permanent link">&para;</a></h2>
<p>The action of updating <code>app-db</code> (in Domino 3) will trigger the <code>v = f(s)</code> part of the flow. </p>
<p>The application state
<code>s</code> has just changed (in Domino 3) and now boom, boom go Dominoes 4, 5, 
and 6, at the end of which we have a new view, <code>v</code>, being shown to the user.</p>
<p>In this domino 4, a query (function) over this app state is automatically
called.  This query function "extracts" data from application state, and 
then computes "a materialised view" of the application state - producing
data which is useful to the view functions in domino, 5.</p>
<p>Now, in this particular case, the query function is pretty trivial.
Because the items are stored in app state, there's not a lot 
to compute and, instead, it acts like a simple extractor or accessor,
just plucking the list of items out of application state:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defn </span><span class="nv">query-fn</span>
  <span class="p">[</span><span class="nv">db</span> <span class="nv">v</span><span class="p">]</span>         <span class="c1">;; db is the current value in app-db, v the query vector</span>
  <span class="p">(</span><span class="ss">:items</span> <span class="nv">db</span><span class="p">))</span>   <span class="c1">;; not much of a materialised view</span>
</code></pre></div>


<p>On program startup, such a <code>query-fn</code> must be associated with a <code>query-id</code>, 
(so it can be used via <code>subscribe</code> in domino 5) using <code>re-frame.core/reg-sub</code>, 
like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">re-frame.core/reg-sub</span>  <span class="c1">;; part of the re-frame API</span>
   <span class="ss">:query-items</span>         <span class="c1">;; query id  </span>
   <span class="nv">query-fn</span><span class="p">)</span>            <span class="c1">;; function to perform the query </span>
</code></pre></div>


<p>Which says "if, in domino 5, you see a <code>(subscribe [:query-items])</code>, then 
call <code>query-fn</code> to compute it".</p>
<h2 id="domino-5-view">Domino 5 - View<a class="headerlink" href="#domino-5-view" title="Permanent link">&para;</a></h2>
<p>Because the query function for <code>:query-items</code> just re-computed a new value, 
any view (function) which uses a <code>(subscribe [:query-items])</code> 
is called automatically (reactively) to re-compute new DOM (in response to a change in its source data).</p>
<p>View functions compute a data structure, in hiccup format, describing
the DOM nodes required. In this "items" case, the view functions will <em>not</em> be generating 
hiccup for the just-deleted item obviously but, other than this, 
the hiccup computed "this time" will be the same as "last time".</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defn </span><span class="nv">items-view</span>
  <span class="p">[]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">items</span>  <span class="p">(</span><span class="nf">subscribe</span> <span class="p">[</span><span class="ss">:query-items</span><span class="p">])]</span>  <span class="c1">;; source items from app state</span>
    <span class="p">[</span><span class="ss">:div</span> <span class="p">(</span><span class="nb">map </span><span class="nv">item-render</span> <span class="o">@</span><span class="nv">items</span><span class="p">)]))</span>   <span class="c1">;; assume item-render already written</span>
</code></pre></div>


<p>Notice how <code>items</code> is "sourced" from "app state" via <code>re-frame.core/subscribe</code>.
It is called with a vector argument, and the first element of that vector is
a query-id which identifies the "materialised view" required by the view.</p>
<p>Note: <code>subscribe</code> queries can be parameterised. So, in real-world apps
you might have this:<br>
  <code>(subscribe [:items "blue"])</code></p>
<p>The vector identifies, first, the query, and then
supplies further arguments. You could think of that as
representing <code>select * from Items where colour="blue"</code>.</p>
<p>Except there's no SQL available and you would be the one to implement
the more sophisticated <code>query-fn</code> capable of handling the 
"where" argument. More in later tutorials.</p>
<h2 id="domino-6-dom">Domino 6 - DOM<a class="headerlink" href="#domino-6-dom" title="Permanent link">&para;</a></h2>
<p>The hiccup returned by the view function
is made into real browser DOM by Reagent/React. No code from you required. Just happens.</p>
<p>The DOM computed "this
time" will be the same as "last time", <strong>except</strong> for the absence of DOM for the
deleted item, so the mutation will be to remove those now-missing
DOM nodes from the browser.</p>
<h2 id="3-4-5-6-summary">3-4-5-6 Summary<a class="headerlink" href="#3-4-5-6-summary" title="Permanent link">&para;</a></h2>
<p>The key point to understand about our 3-4-5-6 example is:</p>
<ul>
<li>a change to app state ...</li>
<li>triggers query functions to rerun ...</li>
<li>which triggers view functions to rerun</li>
<li>which causes modified browser DOM </li>
</ul>
<p>Boom, boom, boom go the dominoes. It is a reactive data flow.</p>
<h2 id="aaaaand-were-done">Aaaaand we're done<a class="headerlink" href="#aaaaand-were-done" title="Permanent link">&para;</a></h2>
<p>At this point, the re-frame app returns to a quiescent state, 
waiting for the next event.</p>
<h2 id="two-sub-cascades">Two Sub-Cascades<a class="headerlink" href="#two-sub-cascades" title="Permanent link">&para;</a></h2>
<p>You might have noticed that there's actually two sub-cascades 1-2-3 and 4-5-6, and they have a similar structure.</p>
<p>In each, it is the second to last domino which 
computes "data descriptions" of the changes required, and it is 
the last domino which does the dirty work and actions these descriptions.</p>
<p>But you seldom need to worry yourself about the dirty work dominos. re-frame 
mostly takes care of them for you.</p>
<blockquote>
<p>One is only fruitful at the price of being rich in oppositions <br></p>
<p>-- Nietzsche, Twilight of the Idols</p>
</blockquote>
<p>Pragmatically, in functional systems, the most interesting part is how and when you arrange to not be pure. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
    <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav
        class="md-footer-nav__inner md-grid"
        aria-label="Footer"
      >

        <!-- Link to previous page -->
        
          <a
            href="../application-state/"
            title="State"
            class="md-footer-nav__link md-footer-nav__link--prev"
            rel="prev"
          >
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                State
              </div>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a
            href="../event-handling-infographic/"
            title="Infographics"
            class="md-footer-nav__link md-footer-nav__link--next"
            rel="next"
          >
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Infographics
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2015-2021 Michael Thompson
          </div>
        
      </div>

      <!-- Social links -->
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/day8" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/wazound" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
    <script src="/re-frame/js/docs.js"></script>

    </div>
    
      <script src="../assets/javascripts/vendor.df0def68.min.js"></script>
      <script src="../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>