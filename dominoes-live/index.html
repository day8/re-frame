


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Derived data, flowing">
      
      
        <link rel="canonical" href="https://day8.github.io/re-frame/dominoes-live/">
      
      
        <meta name="author" content="Mike Thompson">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
    
    <title>Live</title>
    

    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
    
    <link rel="stylesheet" href="/re-frame/stylesheets/klipse.css">
    <link rel="stylesheet" href="/re-frame/stylesheets/codemirror.css">
    

    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Segoe+UI",+"Open+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"Segoe UI", "Open Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@500&display=swap">
    
      <link rel="stylesheet" href="../stylesheets/dominoes-live.css">
    
      <link rel="stylesheet" href="../stylesheets/codehilite-monokai.css">
    
      <link rel="stylesheet" href="../stylesheets/mkdocs.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="light-blue" data-md-color-accent="blue">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#which-app" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://day8.github.io/re-frame/"
      title="re-frame"
      class="md-header-nav__button md-logo"
      aria-label="re-frame"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            re-frame
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Live
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/day8/re-frame/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    day8/re-frame
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../re-frame/" class="md-tabs__link md-tabs__link--active">
          Docs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../FAQs/Inspecting-app-db/" class="md-tabs__link">
          FAQs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../api-intro/" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../releases/2020/" class="md-tabs__link">
          Releases
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../External-Resources/" class="md-tabs__link">
          Resources
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://day8.github.io/re-frame/" title="re-frame" class="md-nav__button md-logo" aria-label="re-frame">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" /></svg>

    </a>
    re-frame
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/day8/re-frame/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    day8/re-frame
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Docs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Docs" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../re-frame/" title="re-frame" class="md-nav__link">
      re-frame
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      THE BASICS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="THE BASICS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        THE BASICS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a-loop/" title="A Data Loop" class="md-nav__link">
      A Data Loop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application-state/" title="State" class="md-nav__link">
      State
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dominoes-30k/" title="Code" class="md-nav__link">
      Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event-handling-infographic/" title="Infographics" class="md-nav__link">
      Infographics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../subscriptions/" title="Subscriptions" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Live
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Live" class="md-nav__link md-nav__link--active">
      Live
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#which-app" class="md-nav__link">
    Which App?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-namespace" class="md-nav__link">
    The Namespace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data-schema" class="md-nav__link">
    The Data Schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-dispatch" class="md-nav__link">
    Event Dispatch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-handlers" class="md-nav__link">
    Event Handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effect-handlers" class="md-nav__link">
    Effect Handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subscription-handlers" class="md-nav__link">
    Subscription Handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-functions" class="md-nav__link">
    View Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subscribing" class="md-nav__link">
    Subscribing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-view-functions" class="md-nav__link">
    The View Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kick-starting-the-app" class="md-nav__link">
    Kick Starting The App
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#t-shirt-unlocked" class="md-nav__link">
    T-Shirt Unlocked
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      INTERMEDIATE 2 & 3
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="INTERMEDIATE 2 & 3" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        INTERMEDIATE 2 & 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../EffectfulHandlers/" title="Effectful Handlers" class="md-nav__link">
      Effectful Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Interceptors/" title="Interceptors" class="md-nav__link">
      Interceptors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Effects/" title="Effects" class="md-nav__link">
      Effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Coeffects/" title="Coeffects" class="md-nav__link">
      Coeffects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../review-todomvc/" title="Review TodoMVC" class="md-nav__link">
      Review TodoMVC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      INTERMEDIATE 4,5 & 6
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="INTERMEDIATE 4,5 & 6" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        INTERMEDIATE 4,5 & 6
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../correcting-a-wrong/" title="Correcting a wrong" class="md-nav__link">
      Correcting a wrong
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flow-mechanics/" title="Flow Mechanics" class="md-nav__link">
      Flow Mechanics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../start-coding/" title="START CODING" class="md-nav__link">
      START CODING
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      MENTAL MODEL OMNIBUS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="MENTAL MODEL OMNIBUS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        MENTAL MODEL OMNIBUS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../all-models-are-wrong/" title="Other Models" class="md-nav__link">
      Other Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../on-dynamics/" title="On Dynamics" class="md-nav__link">
      On Dynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-oriented-design/" title="Data Oriented Design" class="md-nav__link">
      Data Oriented Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interconnections/" title="Interconnections" class="md-nav__link">
      Interconnections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../historical/" title="Historical" class="md-nav__link">
      Historical
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      MORE ADVANCED
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="MORE ADVANCED" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        MORE ADVANCED
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../browser-dynamics/" title="Browser Dynamics" class="md-nav__link">
      Browser Dynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reusable-components/" title="Reusable Components" class="md-nav__link">
      Reusable Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../App-Structure/" title="App Structure" class="md-nav__link">
      App Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Loading-Initial-Data/" title="Loading Initial Data" class="md-nav__link">
      Loading Initial Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Talking-To-Servers/" title="Talking To Servers" class="md-nav__link">
      Talking To Servers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Subscribing-To-External-Data/" title="Subscribing to External Data" class="md-nav__link">
      Subscribing to External Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Debugging/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Performance-Problems/" title="Eek! Performance Problems" class="md-nav__link">
      Eek! Performance Problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solve-the-CPU-hog-problem/" title="Solve the CPU hog problem" class="md-nav__link">
      Solve the CPU hog problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Using-Stateful-JS-Components/" title="Using Stateful JS Components" class="md-nav__link">
      Using Stateful JS Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../The-re-frame-logo/" title="The Logo Backstory" class="md-nav__link">
      The Logo Backstory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      FAQs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="FAQs" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        FAQs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Inspecting-app-db/" title="How can I Inspect app-db?" class="md-nav__link">
      How can I Inspect app-db?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/LoadOnMount/" title="How Do I Load On Mount?" class="md-nav__link">
      How Do I Load On Mount?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/DoINeedReFrame/" title="Reagent looks terrific. Why do I need re-frame?" class="md-nav__link">
      Reagent looks terrific. Why do I need re-frame?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/FocusOnElement/" title="How to focus on an HTML element" class="md-nav__link">
      How to focus on an HTML element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/GlobalInterceptors/" title="How do I register a global interceptor" class="md-nav__link">
      How do I register a global interceptor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/laggy-input/" title="Why is my input field laggy?" class="md-nav__link">
      Why is my input field laggy?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/When-Does-Dispatch-Happen/" title="How long after I do a dispatch does the event get handled?" class="md-nav__link">
      How long after I do a dispatch does the event get handled?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/UseASubscriptionInAnEventHandler/" title="How can I use a subscription in an Event Handler" class="md-nav__link">
      How can I use a subscription in an Event Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Logging/" title="How do I use logging method X" class="md-nav__link">
      How do I use logging method X
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Null-Dispatched-Events/" title="Dispatched Events Are Null" class="md-nav__link">
      Dispatched Events Are Null
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Why-Clear-Sub-Cache/" title="Why do we need to clear the subscription cache when reloading with Figwheel?" class="md-nav__link">
      Why do we need to clear the subscription cache when reloading with Figwheel?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/CatchingEventExceptions/" title="How can I detect exceptions in Event Handlers?" class="md-nav__link">
      How can I detect exceptions in Event Handlers?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/PollADatabaseEvery60/" title="How do I turn on/off polling a database every 60 secs" class="md-nav__link">
      How do I turn on/off polling a database every 60 secs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/ViewsOnGlobalRegistration/" title="re-frame uses side-effecting registrations. Should I feel dirty?" class="md-nav__link">
      re-frame uses side-effecting registrations. Should I feel dirty?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Why-CLJC/" title="Why is re-frame implemented in `.cljc` files" class="md-nav__link">
      Why is re-frame implemented in `.cljc` files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/DB_Normalisation/" title="How do I store normalised data in app-db?" class="md-nav__link">
      How do I store normalised data in app-db?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/FullStackReframe/" title="How do I do full-stack re-frame?" class="md-nav__link">
      How do I do full-stack re-frame?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api-intro/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-builtin-effects/" title="Builtin Effects" class="md-nav__link">
      Builtin Effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-re-frame.core/" title="re-frame.core" class="md-nav__link">
      re-frame.core
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Releases
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Releases" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2020/" title="2020" class="md-nav__link">
      2020
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2019/" title="2019" class="md-nav__link">
      2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2018/" title="2018" class="md-nav__link">
      2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2017/" title="2017" class="md-nav__link">
      2017
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2016/" title="2016" class="md-nav__link">
      2016
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2015/" title="2015" class="md-nav__link">
      2015
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Resources
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Resources" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../External-Resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#which-app" class="md-nav__link">
    Which App?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-namespace" class="md-nav__link">
    The Namespace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data-schema" class="md-nav__link">
    The Data Schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-dispatch" class="md-nav__link">
    Event Dispatch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-handlers" class="md-nav__link">
    Event Handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#effect-handlers" class="md-nav__link">
    Effect Handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subscription-handlers" class="md-nav__link">
    Subscription Handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view-functions" class="md-nav__link">
    View Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subscribing" class="md-nav__link">
    Subscribing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-view-functions" class="md-nav__link">
    The View Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kick-starting-the-app" class="md-nav__link">
    Kick Starting The App
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#t-shirt-unlocked" class="md-nav__link">
    T-Shirt Unlocked
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/day8/re-frame/edit/master/docs/dominoes-live.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                  <h1>Live</h1>
                
                <p>Forget overviews from 60,000 feet or 30,000 feet. Now we're at 0 feet. </p>
<p>We're writing code for a real app - live, in this document.</p>
<h2 id="which-app">Which App?<a class="headerlink" href="#which-app" title="Permanent link">&para;</a></h2>
<p>The "simple" one. </p>
<p>Within the re-frame repository's <code>/examples</code> folder is an app 
called <a href="https://github.com/day8/re-frame/tree/master/examples/simple">/simple</a>.</p>
<p>It has 70 lines of code in a single <a href="https://github.com/day8/re-frame/blob/master/examples/simple/src/simple/core.cljs">namespace</a>.
We'll look at all 70 lines.</p>
<div class="admonition info">
<p>Below, you should see the app running live. <br>
Try changing the display colour to <code>magenta</code>, <code>#f00</code> or <code>#02a6f2</code>.</p>
</div>
<div id="dominoes-live-app">
  <div class="preload">  
    The live application should start here in 60 seconds ...
    <br><br>
    Doesn't work? Maybe try disabling your adblocker for this site.

  </div>
</div>

<div class="admonition info">
<p>When you change the live code on this page, the app will change. But that means 
we'll be loading a ClojureScript compiler into the browser, so be patient. <br>
This live coding is powered by <a href="https://github.com/viebel/klipse">Klipse</a>.</p>
</div>
<h2 id="the-namespace">The Namespace<a class="headerlink" href="#the-namespace" title="Permanent link">&para;</a></h2>
<p>Within our single namespace (of 70 lines), we'll need access to both <code>reagent</code> and <code>re-frame</code>. 
So, at the top we need this: 
<code class="klipse-clojure">
(ns simple.core
  (:require [reagent.core :as reagent]
            [reagent.dom :as rdom]
            [re-frame.core :as rf]))
</code></p>
<div class="admonition note">
<p class="admonition-title">Live Code Fragment</p>
<p>Above, you'll see two vertically stacked boxes. The top one contains the live code. You can edit that code, if you want. 
The one below shows the result of evaluating that code. In this particular case, evaluating a <code>ns</code> gives nil which is not that interesting. </p>
</div>
<h2 id="the-data-schema">The Data Schema<a class="headerlink" href="#the-data-schema" title="Permanent link">&para;</a></h2>
<p>Now, normally, I'd strongly recommended that you write a quality schema
for your application state (the data stored in <code>app-db</code>). But,
here, to minimise cognitive load, we'll cut that corner.</p>
<p>But, we can't cut it completely. You'll still need an
informal description, and here it is ... <code>app-db</code> will contain
a two-key map like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="ss">:time</span>       <span class="p">(</span><span class="nf">js/Date.</span><span class="p">)</span>  <span class="c1">;; current time for display</span>
 <span class="ss">:time-color</span> <span class="s">&quot;#f88&quot;</span><span class="p">}</span>     <span class="c1">;; the colour in which the time should be shown</span>
</code></pre></div>


<h2 id="event-dispatch">Event Dispatch<a class="headerlink" href="#event-dispatch" title="Permanent link">&para;</a></h2>
<p>Events are data.</p>
<p>re-frame uses a vector format for events. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="ss">:time-color-change</span> <span class="s">&quot;red&quot;</span><span class="p">]</span>
</code></pre></div>


<p>The first element in the vector is a keyword which identifies the <code>kind</code> of <code>event</code>.
Further elements are optional, and can provide additional data
associated with the event. The additional value above, <code>"red"</code>, is
presumably the colour.</p>
<p>Here are some other example events:</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="ss">:admit-to-being-satoshi</span> <span class="nv">false</span><span class="p">]</span>
<span class="p">[</span><span class="ss">:dressing/put-pants-on</span>  <span class="s">&quot;velour flares&quot;</span> <span class="p">{</span><span class="ss">:method</span> <span class="ss">:left-leg-first</span> <span class="ss">:belt</span> <span class="nv">false</span><span class="p">}]</span>
</code></pre></div>


<p>For non-trivial applications, the <code>kind</code> keyword will be namespaced, as it is in the 2nd example.</p>
<h3>dispatch</h3>
<p>To send an event, call <code>dispatch</code> with the event vector as the argument. </p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">dispatch</span> <span class="p">[</span><span class="ss">:kind-of-event</span> <span class="nv">value1</span> <span class="nv">value2</span><span class="p">])</span>
</code></pre></div>


<p>For our simple app, we do this ... 
<code class="klipse-clojure">
(defn dispatch-timer-event        ;; &lt;-- defining a function
  []                              ;; &lt;-- no args
  (let [now (js/Date.)]           ;; &lt;-- obtain the current time
    (rf/dispatch [:timer now])))  ;; &lt;-- dispatch an event
</code></p>
<p>Notes: </p>
<ul>
<li>ignore the lower box. When defining a function, the return value is not interesting.</li>
<li>current time is obtained with <code>(js/Date.)</code> which is like <code>new Date()</code> in javascript</li>
<li>uses <code>rf/dispatch</code> - the re-frame API is aliased as <code>rf</code> in the namespace declaration above</li>
</ul>
<p><code class="klipse-clojure">
(defonce do-timer (js/setInterval dispatch-timer-event 1000))
</code></p>
<p>Notes:</p>
<ul>
<li><code>setInterval</code> is used to call <code>dispatch-timer-event</code> every second </li>
<li><code>defonce</code> is like <code>def</code> but it will ensure that only one timer is ever created. Even when doing hot reloading.</li>
</ul>
<p>A timer is an unusual source of events. Usually, it is an app's UI widgets which dispatch events 
(in response to user actions), or an HTTP POST's on-success handler, or a websocket which gets a new packet. 
So, "simple" is a little unusual. Moving on. </p>
<h3>After dispatch</h3>
<p><code>dispatch</code> puts an event onto a queue for processing.</p>
<p>So, an event is not processed synchronously, like a function call. The processing
happens later - asynchronously. Very soon, but not now.</p>
<p>The consumer of the queue is the re-frame <code>router</code> which looks after the event's processing.</p>
<p>The <code>router</code> will:</p>
<ol>
<li>inspect the 1st element of an event vector</li>
<li>look up the event handler (function) <strong>registered</strong> for this kind of event</li>
<li>call this event handler (function) with the necessary arguments</li>
</ol>
<p>Our job, then, is to register an event handler function for 
each kind of event, including this <code>:timer</code> event. </p>
<h2 id="event-handlers">Event Handlers<a class="headerlink" href="#event-handlers" title="Permanent link">&para;</a></h2>
<p>Collectively, event handlers provide the control logic in a re-frame application.</p>
<p>In this application, three kinds of event are dispatched:</p>
<ul>
<li><code>:initialize</code> - once when the program boots up</li>
<li><code>:time-color-change</code> - whenever the user changes the colour text field</li>
<li><code>:timer</code> - once a second </li>
</ul>
<p>Having 3 events means we'll be registering 3 event handlers.</p>
<h3>Registering Event Handlers</h3>
<p>Event handler functions:</p>
<ul>
<li>take two arguments <code>coeffects</code> and <code>event</code></li>
<li>return <code>effects</code></li>
</ul>
<p>Conceptually, you can think of the argument <code>coeffects</code> as being "the current state of the world". 
And you can think of event handlers as computing how the world should be changed 
by the arriving event. They return (as data) how the world should be changed by the event - <code>the side effects</code> of the event.</p>
<p>Event handlers can be registered in two ways:</p>
<ul>
<li><code>reg-event-fx</code></li>
<li><code>reg-event-db</code>  </li>
</ul>
<p>One ends in <code>-fx</code> and the other in <code>-db</code>.</p>
<ul>
<li><code>reg-event-fx</code> can take many <code>coeffects</code> and can return many <code>effects</code></li>
<li><code>reg-event-db</code> allows you to write simpler handlers for the common case where you want 
  them to take only one <code>coeffect</code> - the current app state - and return one <code>effect</code> - the 
  updated app state.</li>
</ul>
<p>Many vs One. Because of its simplicity, we'll be using the latter one here: <code>reg-event-db</code>.</p>
<h3>reg-event-db</h3>
<p>We register event handlers using re-frame's API: </p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">rf/reg-event-db</span>           <span class="c1">;; &lt;-- the re-frame API function to use</span>
  <span class="ss">:the-event-id</span>            <span class="c1">;; &lt;-- the event id </span>
  <span class="nv">the-event-handler-fn</span><span class="p">)</span>    <span class="c1">;; &lt;-- the handler function</span>
</code></pre></div>


<p>The handler function you provide should expect two arguments:</p>
<ul>
<li><code>db</code> - the current application state  (the map value contained in <code>app-db</code>)</li>
<li><code>e</code> - the event vector  (given to <code>dispatch</code>)</li>
</ul>
<p>So, your handler function will have a signature like this: <code>(fn [db e] ...)</code>.</p>
<p>These event handlers must compute and return the new state of
the application, which means they return a modified version of <code>db</code>.</p>
<h3>:timer</h3>
<p><code class="klipse-clojure">
(rf/reg-event-db               <br />
  :timer
  (fn [db [_ new-time]]          ;; notice how we destructure the event vector
    (assoc db :time new-time)))  ;; compute and return the new application state
(rf/dispatch-sync [:timer (js/Date.)])
</code></p>
<p>Notes:</p>
<ol>
<li>the <code>event</code> (2nd parameter) will be like <code>[:timer a-js-time]</code></li>
<li><a href="https://clojure.org/guides/destructuring">sequence destructuring</a> 
   is used to extract the 2nd element of that event vector (ignores first with <code>_</code>)</li>
<li><code>db</code> is a map, containing two keys (see description above)</li>
<li>this handler computes a new application state from <code>db</code>, and returns it</li>
<li>it just <code>assocs</code> in the <code>new-time</code> value</li>
</ol>
<h3>:initialize</h3>
<p>Once on startup, application state must be initialised. We
want to put a sensible value into <code>app-db</code>, which starts out containing an empty map <code>{}</code>.</p>
<p>A single <code>(dispatch [:initialize])</code> will happen early in the 
app's life (more on this below), and we need to register an <code>event handler</code>
for it. </p>
<p>This event handler is slightly unusual because it ignores both of its arguments. 
There's nothing in the <code>event</code> vector which it needs. Nor is the existing value in 
<code>db</code>. It just wants to plonk a completely new value into <code>app-db</code></p>
<p><code class="klipse-clojure">
(rf/reg-event-db              ;; sets up initial application state
  :initialize
  (fn [ _ _ ]                 ;; arguments not important, so use _
    {:time (js/Date.)         ;; returned value put into app-db 
     :time-color "orange"}))  ;; so the app state will be a map with two keys
nil
</code></p>
<p>For comparison, here's how we could have written this if we <strong>did</strong> care about the existing value in <code>db</code>: </p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">rf/reg-event-db</span>
  <span class="ss">:initialize</span>
  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">db</span> <span class="nv">_</span><span class="p">]</span>                 <span class="c1">;; we use db this time, so name it</span>
    <span class="p">(</span><span class="nb">-&gt; </span><span class="nv">db</span>                   <span class="c1">;; db is initially just {}</span>
      <span class="p">(</span><span class="nb">assoc </span><span class="ss">:time</span> <span class="p">(</span><span class="nf">js/Date.</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">assoc </span><span class="ss">:time-color</span> <span class="s">&quot;orange&quot;</span><span class="p">)))</span>
</code></pre></div>


<h3>:time-color-change</h3>
<p>When the user enters a new colour value (into the input field) the view will <code>(dispatch [:time-color-change new-colour])</code> (more on this below). </p>
<p><code class="klipse-clojure">
(rf/reg-event-db
  :time-color-change          <br />
  (fn [db [_ new-color-value]]
    (assoc db :time-color new-color-value)))   ;; compute and return the new application state
nil
</code></p>
<p>Notes:</p>
<ol>
<li>it updates <code>db</code> to contain the new colour, provided as the 2nd element of the event </li>
</ol>
<h2 id="effect-handlers">Effect Handlers<a class="headerlink" href="#effect-handlers" title="Permanent link">&para;</a></h2>
<p>Domino 3 actions the <code>effects</code> returned by event handlers.</p>
<p>In this "simple" application, our event handlers are implicitly returning 
only one effect: "update application state". </p>
<p>This particular <code>effect</code> is accomplished by a re-frame-supplied 
<code>effect</code> handler. So, there's nothing for us to do for this domino. We are 
using a standard re-frame effect handler.</p>
<p>And this is not unusual. You seldom write <code>effect</code> handlers. But it is covered in 
a later tutorial. </p>
<h2 id="subscription-handlers">Subscription Handlers<a class="headerlink" href="#subscription-handlers" title="Permanent link">&para;</a></h2>
<p>Subscription handlers, or <code>query</code> functions, take application state as an argument 
and run a query over it, returning something called
a "materialised view" of that application state.</p>
<p>When the application state changes, subscription functions are 
re-run by re-frame, to compute new values (new materialised views).</p>
<p>Ultimately, the data returned by these <code>query</code> functions flow through into 
the <code>view</code> functions (Domino 5).</p>
<p>One subscription can
source data from other subscriptions. So it is possible to
create a tree structure of data flow. </p>
<p>The Views (Domino 5) are the leaves of this tree.  The tree's 
root is <code>app-db</code> and the intermediate nodes between the two 
are computations being performed by the query functions of Domino 4.</p>
<p>Now, the two subscriptions below are trivial. They just extract part of the application
state and return it. So, there's virtually no computation - the materialised view they
produce is the same as that stored in <code>app-db</code>. A more interesting tree
of subscriptions, and more explanation, can be found in the todomvc example.</p>
<h3>reg-sub</h3>
<p><code>reg-sub</code> associates a <code>query id</code> with a function that computes
 that query, like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">rf/reg-sub</span>
  <span class="ss">:some-query-id</span>  <span class="c1">;; query id (used later in subscribe)</span>
  <span class="nv">a-query-fn</span><span class="p">)</span>     <span class="c1">;; the function which will compute the query</span>
</code></pre></div>


<p>Later, a view function (domino 5) will subscribe to a query like this:
<code>(subscribe [:some-query-id])</code>, and <code>a-query-fn</code> will be used 
to perform the query over the application state.</p>
<p>Each time application state changes, <code>a-query-fn</code> will be
called again to compute a new materialised view (a new computation over <code>app-db</code>)
and that new value will be given to all <code>view</code> functions which are subscribed
to <code>:some-query-id</code>. These <code>view</code> functions will then be called to compute the 
new DOM state (because the views depend on query results which have changed).</p>
<p>Along this reactive chain of dependencies, re-frame will ensure the 
necessary calls are made, at the right time.</p>
<p>Here's the code for defining our 2 subscription handlers:
<code class="klipse-clojure">
(rf/reg-sub
  :time
  (fn [db _]     ;; db is current app state. 2nd unused param is query vector
    (:time db))) ;; return a query computation over the application state
</code></p>
<p><code class="klipse-clojure">
(rf/reg-sub
  :time-color
  (fn [db _]
    (:time-color db)))
</code></p>
<p>Both of these queries are trivial. They are known as "accessor", or level 2, subscriptions. More on that soon.</p>
<h2 id="view-functions">View Functions<a class="headerlink" href="#view-functions" title="Permanent link">&para;</a></h2>
<p><code>view</code> functions compute Hiccup.  They are "Data in, Hiccup out" and they are Reagent 
components. </p>
<p>A SPA will have lots of <code>view</code> functions, and collectively, 
they render the app's UI.</p>
<h2 id="subscribing">Subscribing<a class="headerlink" href="#subscribing" title="Permanent link">&para;</a></h2>
<p>To render a hiccup representation of some part of the app state, view functions must query 
for that part of <code>app-db</code>, by using <code>subscribe</code>.</p>
<p><code>subscribe</code> is used like this:</p>
<div class="codehilite"><pre><span></span><code>   <span class="p">(</span><span class="nf">rf/subscribe</span>  <span class="p">[</span><span class="nv">query-id</span> <span class="nb">some </span><span class="nv">optional</span> <span class="nv">query</span> <span class="nv">parameters</span><span class="p">])</span>
</code></pre></div>


<p>So <code>subscribe</code> takes one argument, assumed to be a vector.</p>
<p>The first element in the vector identifies the query, 
and the other elements are optional
query parameters. With a traditional database a query might be:</p>
<div class="codehilite"><pre><span></span><code><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="ss">&quot;blah&quot;</span>
</code></pre></div>


<p>In re-frame, that would look like:
   <code>(subscribe  [:customer-query "blah"])</code>,
which would return a <code>ratom</code> holding the customer state (a value which might change over time!).</p>
<div class="admonition warning">
<p class="admonition-title">Rookie Mistake</p>
<p>Because subscriptions return a <code>ratom</code> (a Reagent atom), they must always be dereferenced to 
obtain the value (using <a href="https://clojuredocs.org/clojure.core/deref">deref</a> or <a href="https://en.wikibooks.org/wiki/Learning_Clojure/Reader_Macros">the reader macro</a>  <code>@</code>). Forgetting to do this is a recurring papercut for newbies.</p>
</div>
<h2 id="the-view-functions">The View Functions<a class="headerlink" href="#the-view-functions" title="Permanent link">&para;</a></h2>
<p>This view function renders the clock:
<code class="klipse-clojure">
(defn clock
  []
  (let [colour @(rf/subscribe [:time-color])
        time   (-&gt; @(rf/subscribe [:time])
                    .toTimeString
                    (clojure.string/split " ")
                    first)]
  [:div.example-clock {:style {:color colour}} time]))
</code></p>
<p>As you can see, it uses <code>subscribe</code> twice to obtain two pieces of data from <code>app-db</code>. 
If either value changes, reagent will automatically re-run this view function, 
computing new hiccup, which means new DOM.</p>
<p>Using the power of <code>klipse</code>, we can render just the <code>clock</code> component: 
<code class="klipse-reagent">
[clock]
</code></p>
<p>When an event handler changes a value in <code>app-db</code>, <code>clock</code> will rerender. Try it. 
Uncomment the following <code>dispatch</code> to change the colour. 
<code class="klipse-clojure">
(comment (rf/dispatch  [:time-color-change "green"]))
</code></p>
<p>And this view function renders the input field:
<code class="klipse-clojure">
(defn color-input
  []
  (let [gettext (fn [e] (-&gt; e .-target .-value))
        emit    (fn [e] (rf/dispatch [:time-color-change (gettext e)]))]
    [:div.color-input
      "Display color: "
      [:input {:type "text"
               :style {:border "1px solid #CCC" }
               :value @(rf/subscribe [:time-color])        ;; subscribe
               :on-change emit}]]))              ;; &lt;---
</code></p>
<p>Notice how it does BOTH a <code>subscribe</code> to obtain the current value AND 
a <code>dispatch</code> to say when it has changed (look for <code>emit</code>). </p>
<p>It is very common for view functions to render event-dispatching functions into the DOM.
The user's interaction with the UI is usually a large source of events.</p>
<p>Notice also how we use <code>@</code> in front of <code>subscribe</code> to obtain the value out of the subscription. It is almost as if the subscription is an atom holding a value (which can change over time). </p>
<p>We can render the <code>color-input</code> as any other reagent component:
<code class="klipse-reagent">
[color-input]
</code></p>
<p>And then there's a parent <code>view</code> to arrange the others. It contains no 
subscriptions or dispatching of its own:
<code class="klipse-clojure">
(defn ui
  []
  [:div
   [:h1 "The time is now:"]
   [clock]
   [color-input]])
</code></p>
<div class="admonition note">
<p><code>view</code> functions form a hierarchy, often with 
data flowing from parent to child via
arguments (props in React). So, not every view needs a subscription if the 
values passed in from a parent component are sufficient.</p>
</div>
<div class="admonition note">
<p><code>view</code> functions never directly access <code>app-db</code>. Data is 
only ever sourced via subscriptions. </p>
</div>
<h2 id="kick-starting-the-app">Kick Starting The App<a class="headerlink" href="#kick-starting-the-app" title="Permanent link">&para;</a></h2>
<p>Below, the function <code>run</code> is called to kick off the application once the HTML page has loaded.</p>
<p>It has two tasks:</p>
<ol>
<li>Load the initial application state</li>
<li>Load the GUI by "mounting" the root-level<br />
<code>view</code> - in our case, <code>ui</code> -
   onto an existing DOM element (with id <code>app</code>). </li>
</ol>
<p><code class="klipse-clojure">
(defn mount-ui
  []
  (rdom/render [ui]                 ;; mount the application's ui
                  (js/document.getElementById "dominoes-live-app")))
(defn run
  []
  (rf/dispatch-sync [:initialize])     ;; puts a value into application state
  (mount-ui))
</code></p>
<p>When it comes to establishing initial application state, you'll
notice the use of <code>dispatch-sync</code>, rather than <code>dispatch</code>. This is a simplifying cheat
which ensures that a correct
structure exists in <code>app-db</code> before any subscriptions or event handlers run. </p>
<p>After <code>run</code> is called, the app passively waits for <code>events</code>. 
Nothing happens without an <code>event</code>.</p>
<p><code class="klipse-clojure">
(run)
</code></p>
<p>The run function renders the app in the DOM element whose id is <code>dominoes-live-app</code>: this DOM element is located at the top of the page. 
This is the element we used to show how the app looks at the top of this page</p>
<p>To save you the trouble of scrolling up to the top of the page, I decided to render the whole app as a 
reagent element, just here:</p>
<p><code class="klipse-reagent">
[ui]
</code></p>
<h2 id="t-shirt-unlocked">T-Shirt Unlocked<a class="headerlink" href="#t-shirt-unlocked" title="Permanent link">&para;</a></h2>
<p>Good news.  If you've read this far,
your insider's T-shirt will be arriving soon - it will feature turtles, 
<a href="http://xkcd.com/1416/">xkcd</a> and something about "data all the way down". 
But we're still working on the hilarious caption bit. Open a
repo issue with a suggestion.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
    <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav
        class="md-footer-nav__inner md-grid"
        aria-label="Footer"
      >

        <!-- Link to previous page -->
        
          <a
            href="../subscriptions/"
            title="Subscriptions"
            class="md-footer-nav__link md-footer-nav__link--prev"
            rel="prev"
          >
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Subscriptions
              </div>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a
            href="../EffectfulHandlers/"
            title="Effectful Handlers"
            class="md-footer-nav__link md-footer-nav__link--next"
            rel="next"
          >
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Effectful Handlers
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2015-2020 Michael Thompson
          </div>
        
      </div>

      <!-- Social links -->
      
  <div class="md-footer-social">
    
      
      
      <a href="https://github.com/day8" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
      <a href="https://twitter.com/wazound" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
    
    <script src="https://unpkg.com/react@16.13.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.13.0/umd/react-dom.development.js"></script>
    <script src="/re-frame/javascripts/klipse_config.js"></script>
    <script src="/re-frame/javascripts/klipse_plugin.js"></script>
    <script src="/re-frame/javascripts/klipse_reagent_fix.js"></script>
    

    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>