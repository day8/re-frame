


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Derived data, flowing">
      
      
        <link rel="canonical" href="https://day8.github.io/re-frame/Coeffects/">
      
      
        <meta name="author" content="Mike Thompson">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.9">
    
    
    
    <title>Coeffects</title>
    

    
      <link rel="stylesheet" href="../assets/stylesheets/main.36ee6aaa.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.83bccb1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#2094f3">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback">
        <style>body,input{font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Source Code Pro",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,300;0,500;1,400&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@200;300;400&display=swap">
    
      <link rel="stylesheet" href="../stylesheets/dominoes-live.css">
    
      <link rel="stylesheet" href="../stylesheets/codehilite-monokai.css">
    
      <link rel="stylesheet" href="../stylesheets/mkdocs.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coeffects" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://day8.github.io/re-frame/"
      title="re-frame"
      class="md-header-nav__button md-logo"
      aria-label="re-frame"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            re-frame
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Coeffects
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/day8/re-frame/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    day8/re-frame
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../re-frame/" class="md-tabs__link md-tabs__link--active">
          Docs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../FAQs/Inspecting-app-db/" class="md-tabs__link">
          FAQs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../api-intro/" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../releases/2023/" class="md-tabs__link">
          Releases
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../External-Resources/" class="md-tabs__link">
          Resources
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://day8.github.io/re-frame/" title="re-frame" class="md-nav__button md-logo" aria-label="re-frame">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg>

    </a>
    re-frame
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/day8/re-frame/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    day8/re-frame
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Docs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Docs" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../re-frame/" title="re-frame" class="md-nav__link">
      re-frame
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      THE BASICS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="THE BASICS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        THE BASICS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a-loop/" title="A Data Loop" class="md-nav__link">
      A Data Loop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application-state/" title="State" class="md-nav__link">
      State
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dominoes-30k/" title="Code" class="md-nav__link">
      Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event-handling-infographic/" title="Infographics" class="md-nav__link">
      Infographics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../subscriptions/" title="Subscriptions" class="md-nav__link">
      Subscriptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dominoes-live/" title="Live" class="md-nav__link">
      Live
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    
    <label class="md-nav__link" for="nav-2-3">
      INTERMEDIATE 2 & 3
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="INTERMEDIATE 2 & 3" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        INTERMEDIATE 2 & 3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../EffectfulHandlers/" title="Effectful Handlers" class="md-nav__link">
      Effectful Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Interceptors/" title="Interceptors" class="md-nav__link">
      Interceptors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Effects/" title="Effects" class="md-nav__link">
      Effects
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Coeffects
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Coeffects" class="md-nav__link md-nav__link--active">
      Coeffects
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-they" class="md-nav__link">
    What Are They?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-motivating-example" class="md-nav__link">
    A Motivating Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-we-want-it" class="md-nav__link">
    How We Want It
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abracadabra" class="md-nav__link">
    Abracadabra
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#which-interceptors" class="md-nav__link">
    Which Interceptors?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inject-cofx" class="md-nav__link">
    inject-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-inject-cofx" class="md-nav__link">
    More inject-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meet-reg-cofx" class="md-nav__link">
    Meet reg-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-reg-cofx" class="md-nav__link">
    Example Of reg-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#another-example-of-reg-cofx" class="md-nav__link">
    Another Example Of reg-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-interceptors" class="md-nav__link">
    Secret Interceptors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-5-point-summary" class="md-nav__link">
    The 5 Point Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../review-todomvc/" title="Review TodoMVC" class="md-nav__link">
      Review TodoMVC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      INTERMEDIATE 4,5 & 6
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="INTERMEDIATE 4,5 & 6" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        INTERMEDIATE 4,5 & 6
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../correcting-a-wrong/" title="Correcting a wrong" class="md-nav__link">
      Correcting a wrong
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flow-mechanics/" title="Flow Mechanics" class="md-nav__link">
      Flow Mechanics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../start-coding/" title="START CODING" class="md-nav__link">
      START CODING
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      MENTAL MODEL OMNIBUS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="MENTAL MODEL OMNIBUS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        MENTAL MODEL OMNIBUS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../all-models-are-wrong/" title="Other Models" class="md-nav__link">
      Other Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../on-dynamics/" title="On Dynamics" class="md-nav__link">
      On Dynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-oriented-design/" title="Data Oriented Design" class="md-nav__link">
      Data Oriented Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interconnections/" title="Interconnections" class="md-nav__link">
      Interconnections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../historical/" title="Historical" class="md-nav__link">
      Historical
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      MORE ADVANCED
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="MORE ADVANCED" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        MORE ADVANCED
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../on-stable-dom-handlers/" title="Stable Dom Handlers" class="md-nav__link">
      Stable Dom Handlers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../browser-dynamics/" title="Browser Dynamics" class="md-nav__link">
      Browser Dynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reusable-components/" title="Reusable Components" class="md-nav__link">
      Reusable Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../App-Structure/" title="App Structure" class="md-nav__link">
      App Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Loading-Initial-Data/" title="Loading Initial Data" class="md-nav__link">
      Loading Initial Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Talking-To-Servers/" title="Talking To Servers" class="md-nav__link">
      Talking To Servers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Subscribing-To-External-Data/" title="Subscribing to External Data" class="md-nav__link">
      Subscribing to External Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Debugging/" title="Debugging" class="md-nav__link">
      Debugging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Performance-Problems/" title="Eek! Performance Problems" class="md-nav__link">
      Eek! Performance Problems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Solve-the-CPU-hog-problem/" title="Solve the CPU hog problem" class="md-nav__link">
      Solve the CPU hog problem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Using-Stateful-JS-Components/" title="Using Stateful JS Components" class="md-nav__link">
      Using Stateful JS Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../The-re-frame-logo/" title="The Logo Backstory" class="md-nav__link">
      The Logo Backstory
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      FAQs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="FAQs" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        FAQs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Inspecting-app-db/" title="How can I Inspect app-db?" class="md-nav__link">
      How can I Inspect app-db?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/BestPractice/" title="What Is Best Practice?" class="md-nav__link">
      What Is Best Practice?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/LoadOnMount/" title="How Do I Load On Mount?" class="md-nav__link">
      How Do I Load On Mount?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/DoINeedReFrame/" title="Reagent looks terrific. Why do I need re-frame?" class="md-nav__link">
      Reagent looks terrific. Why do I need re-frame?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/FocusOnElement/" title="How to focus on an HTML element" class="md-nav__link">
      How to focus on an HTML element
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/GlobalInterceptors/" title="How do I register a global interceptor" class="md-nav__link">
      How do I register a global interceptor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/laggy-input/" title="Why is my input field laggy?" class="md-nav__link">
      Why is my input field laggy?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/When-Does-Dispatch-Happen/" title="How long after I do a dispatch does the event get handled?" class="md-nav__link">
      How long after I do a dispatch does the event get handled?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/UseASubscriptionInAnEventHandler/" title="How can I use a subscription in an Event Handler" class="md-nav__link">
      How can I use a subscription in an Event Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/UseASubscriptionInAJsEvent/" title="How can I use a subscription in Js Event" class="md-nav__link">
      How can I use a subscription in Js Event
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Logging/" title="How do I use logging method X" class="md-nav__link">
      How do I use logging method X
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Null-Dispatched-Events/" title="Dispatched Events Are Null" class="md-nav__link">
      Dispatched Events Are Null
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Why-Clear-Sub-Cache/" title="Why do we need to clear the subscription cache when reloading with Figwheel?" class="md-nav__link">
      Why do we need to clear the subscription cache when reloading with Figwheel?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/CatchingEventExceptions/" title="How can I detect exceptions in Event Handlers?" class="md-nav__link">
      How can I detect exceptions in Event Handlers?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/PollADatabaseEvery60/" title="How do I turn on/off polling a database every 60 secs" class="md-nav__link">
      How do I turn on/off polling a database every 60 secs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/ViewsOnGlobalRegistration/" title="re-frame uses side-effecting registrations. Should I feel dirty?" class="md-nav__link">
      re-frame uses side-effecting registrations. Should I feel dirty?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/Why-CLJC/" title="Why is re-frame implemented in `.cljc` files" class="md-nav__link">
      Why is re-frame implemented in `.cljc` files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/DB_Normalisation/" title="How do I store normalised data in app-db?" class="md-nav__link">
      How do I store normalised data in app-db?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/FullStackReframe/" title="How do I do full-stack re-frame?" class="md-nav__link">
      How do I do full-stack re-frame?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api-intro/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-builtin-effects/" title="Builtin Effects" class="md-nav__link">
      Builtin Effects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api-re-frame.core/" title="re-frame.core" class="md-nav__link">
      re-frame.core
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Releases
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Releases" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2023/" title="2023" class="md-nav__link">
      2023
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2022/" title="2022" class="md-nav__link">
      2022
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2021/" title="2021" class="md-nav__link">
      2021
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2020/" title="2020" class="md-nav__link">
      2020
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2019/" title="2019" class="md-nav__link">
      2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2018/" title="2018" class="md-nav__link">
      2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2017/" title="2017" class="md-nav__link">
      2017
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2016/" title="2016" class="md-nav__link">
      2016
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../releases/2015/" title="2015" class="md-nav__link">
      2015
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Resources
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Resources" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../External-Resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-are-they" class="md-nav__link">
    What Are They?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-motivating-example" class="md-nav__link">
    A Motivating Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-we-want-it" class="md-nav__link">
    How We Want It
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abracadabra" class="md-nav__link">
    Abracadabra
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#which-interceptors" class="md-nav__link">
    Which Interceptors?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inject-cofx" class="md-nav__link">
    inject-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-inject-cofx" class="md-nav__link">
    More inject-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meet-reg-cofx" class="md-nav__link">
    Meet reg-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-reg-cofx" class="md-nav__link">
    Example Of reg-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#another-example-of-reg-cofx" class="md-nav__link">
    Another Example Of reg-cofx
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secret-interceptors" class="md-nav__link">
    Secret Interceptors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-5-point-summary" class="md-nav__link">
    The 5 Point Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/day8/re-frame/edit/master/docs/Coeffects.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="coeffects">Coeffects<a class="headerlink" href="#coeffects" title="Permanent link">&para;</a></h1>
<p>This tutorial explains <code>coeffects</code>.</p>
<p>It explains what they are, how they can be "injected", and how
to manage them in tests.</p>
<h2 id="what-are-they">What Are They?<a class="headerlink" href="#what-are-they" title="Permanent link">&para;</a></h2>
<p>Event handlers compute how the world should change in response to an event and, to do that, 
they need to first know the current state of the world. </p>
<p><code>coeffects</code> is the current state of the world, as data, as presented to an event handler.</p>
<p>Many event handlers only need application state to do their job - that's as much of "the world"
as they need to know about. To make this common case easy to program, 
there's a specific registration function, called <code>reg-event-db</code>,
which delivers ONLY the coeffect <code>db</code> to the event handler  (and <code>event</code> of course). </p>
<p>Such an event handler will have this signature:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">db</span> <span class="nv">event</span><span class="p">]</span> 
   <span class="nv">...</span> <span class="nv">return</span> <span class="nv">updated</span> <span class="nv">db</span><span class="p">)</span>
</code></pre></div>


<p>But event handlers sometimes need to know more about the world OR have more inputs 
than just application state. Sometimes they need "inputs" like a random number, or a GUID,
or the current datetime. Perhaps they need access to LocalStore, or Cookies, or a
DataScript connection.</p>
<p>We refer to these inputs collectively as the event handler's <code>coeffects</code>.  When more than
application state is needed, we use the registration function <code>reg-event-fx</code> and the event handler has
a signature like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">coeffects</span> <span class="nv">event</span><span class="p">]</span>     <span class="c1">;; first arg is often abbreviated to cofx </span>
    <span class="nv">...</span> <span class="nv">return</span> <span class="nv">a</span> <span class="nb">map </span><span class="nv">of</span> <span class="nv">effects</span><span class="p">)</span>
</code></pre></div>


<p>Notice how previously the first arg was <code>db</code> and now it is <code>coeffects</code>.  <code>coeffects</code> is a map, and it contains a 
<code>:db</code> key which is the current application state. But it can contain other keys holding data about other aspects of 
the world. So <code>coeffects</code> is a superset of <code>db</code>. It is a bigger world to compute against. </p>
<h2 id="a-motivating-example">A Motivating Example<a class="headerlink" href="#a-motivating-example" title="Permanent link">&para;</a></h2>
<p>Imagine you had an event handler which needed to "know" a value in LocalStore, in order to
compute an event's effect. </p>
<p>It could be written to access data directly from LocalStore:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-event-db</span>
   <span class="ss">:load-defaults</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">db</span> <span class="nv">_</span><span class="p">]</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">val </span><span class="p">(</span><span class="nf">js-&gt;clj</span> <span class="p">(</span><span class="nf">.getItem</span> <span class="nv">js/localStorage</span> <span class="s">&quot;defaults-key&quot;</span><span class="p">))]</span>  <span class="c1">;; &lt;-- Problem</span>
       <span class="p">(</span><span class="nb">assoc </span><span class="nv">db</span> <span class="ss">:defaults</span> <span class="nv">val</span><span class="p">))))</span>
</code></pre></div>


<p>This works, but there's a cost.</p>
<p>Because it has directly accessed LocalStore, this event handler is not
pure, and impure functions cause well-documented paper cuts, and paper cuts
have a way of accumulating non-linearly.</p>
<h2 id="how-we-want-it">How We Want It<a class="headerlink" href="#how-we-want-it" title="Permanent link">&para;</a></h2>
<p>Our goal in this tutorial is to rewrite this event handler so
that it <strong>only</strong> uses data from arguments (coeffects!). This will take a few steps.</p>
<p>The first is that we switch to
using <code>reg-event-fx</code> (instead of <code>reg-event-db</code>).</p>
<p>Event handlers registered via <code>reg-event-fx</code> are slightly
different to those registered via <code>reg-event-db</code>. <code>-fx</code> handlers
get two arguments, but the first is not <code>db</code>. Instead it
is an argument which we will call <code>cofx</code> (that's a nice distinct
name which will aid communication).</p>
<p>Previous tutorials showed there's a <code>:db</code> key in <code>cofx</code>.  We
now want <code>cofx</code> to have other keys and values, like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-event-fx</span>                     <span class="c1">;; note: -fx</span>
   <span class="ss">:load-defaults</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">cofx</span> <span class="nv">event</span><span class="p">]</span>                 <span class="c1">;; cofx means coeffects</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">val </span><span class="p">(</span><span class="ss">:local-store</span> <span class="nv">cofx</span><span class="p">)</span>  <span class="c1">;; &lt;-- get data from cofx</span>
           <span class="nv">db</span>  <span class="p">(</span><span class="ss">:db</span> <span class="nv">cofx</span><span class="p">)]</span>          <span class="c1">;; &lt;-- more data from cofx</span>
       <span class="p">{</span><span class="ss">:db</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">db</span> <span class="ss">:defaults</span> <span class="nv">val</span><span class="p">)})))</span> <span class="c1">;; returns an effect</span>
</code></pre></div>


<p>Notice how <code>cofx</code> magically contains a <code>:local-store</code> key with the
right value. Nice! But how do we make this magic happen?</p>
<h2 id="abracadabra">Abracadabra<a class="headerlink" href="#abracadabra" title="Permanent link">&para;</a></h2>
<p>Each time an event is "handled", a brand new <code>context</code> (map)
is created, and within that <code>context</code> is a <code>:coeffects</code> key which
is a further map (initially empty).</p>
<p>That pristine <code>context</code> value (containing, in turn, a pristine <code>:coeffects</code> map) is threaded
through the <code>:before</code> function of each interceptor (in the event handler chain) 
before it finally reaches the registered event handler, which sits on the end of the chain, 
itself wrapped up in an interceptor. We know this story well from a previous tutorial.</p>
<p>These <code>:before</code> functions have the<br />
opportunity to <code>assoc</code> into the <code>:coeffects</code> map (within the <code>context</code>), cumulatively adding to what it holds.<br />
Later, our event handler, which sits on the end of the chain, finds that its first 
 <code>cofx</code> argument contains just the right data, like, for example, a value for the key <code>:local-store</code>. 
So, it is the event handler's Interceptor chain which can add to the "world" eventually 
"seen" by an event handler. </p>
<h2 id="which-interceptors">Which Interceptors?<a class="headerlink" href="#which-interceptors" title="Permanent link">&para;</a></h2>
<p>If Interceptors put data in <code>:coeffects</code>, then we'll need to add the right ones
when we register our event handler.</p>
<p>Something like this (this handler is the same as before, except for one detail):</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-event-fx</span>
   <span class="ss">:load-defaults</span>
   <span class="p">[</span> <span class="p">(</span><span class="nf">inject-cofx</span> <span class="ss">:local-store</span> <span class="s">&quot;defaults-key&quot;</span><span class="p">)</span> <span class="p">]</span>     <span class="c1">;; &lt;-- this is new</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">cofx</span> <span class="nv">event</span><span class="p">]</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">val </span><span class="p">(</span><span class="ss">:local-store</span> <span class="nv">cofx</span><span class="p">)</span>
           <span class="nv">db</span>  <span class="p">(</span><span class="ss">:db</span> <span class="nv">cofx</span><span class="p">)]</span>
       <span class="p">{</span><span class="ss">:db</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">db</span> <span class="ss">:defaults</span> <span class="nv">val</span><span class="p">)})))</span>
</code></pre></div>


<p>Look at that - my event handler now has a new Interceptor which will inject (assoc) the
right key/value pair (<code>:local-store</code>)
into <code>context's</code> <code>:coeffects</code>, which itself is the map which goes on to be the first argument
to our event handler (aka <code>cofx</code>).</p>
<h2 id="inject-cofx"><code>inject-cofx</code><a class="headerlink" href="#inject-cofx" title="Permanent link">&para;</a></h2>
<p><code>inject-cofx</code> is part of the re-frame API.</p>
<p>It is a function which returns an Interceptor whose <code>:before</code> function loads
a key/value pair into a <code>context's</code> <code>:coeffects</code> map.</p>
<p><code>inject-cofx</code> takes either one or two arguments. The first is always the <code>id</code> of the coeffect
required (called a <code>cofx-id</code>). The 2nd is an optional additional value.</p>
<p>So, in the case above, the <code>cofx-id</code> was <code>:local-store</code>  and the additional value
was "defaults-key" which was presumably the LocalStore key.</p>
<h2 id="more-inject-cofx">More <code>inject-cofx</code><a class="headerlink" href="#more-inject-cofx" title="Permanent link">&para;</a></h2>
<p>Here's some other usage examples:</p>
<ul>
<li><code>(inject-cofx :random-int 10)</code></li>
<li><code>(inject-cofx :guid)</code></li>
<li><code>(inject-cofx :now)</code></li>
</ul>
<p>I could create an event handler which has access to 3 coeffects:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-event-fx</span>
    <span class="ss">:some-id</span>
    <span class="p">[(</span><span class="nf">inject-cofx</span> <span class="ss">:random-int</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="nf">inject-cofx</span> <span class="ss">:now</span><span class="p">)</span>  <span class="p">(</span><span class="nf">inject-cofx</span> <span class="ss">:local-store</span> <span class="s">&quot;blah&quot;</span><span class="p">)]</span>  <span class="c1">;; 3</span>
    <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">cofx</span> <span class="nv">_</span><span class="p">]</span>
       <span class="nv">...</span> <span class="nv">in</span> <span class="nv">here</span> <span class="nv">I</span> <span class="nv">can</span> <span class="nv">access</span> <span class="nv">cofx</span><span class="ss">&#39;s</span> <span class="nb">keys </span><span class="ss">:now</span> <span class="ss">:local-store</span> <span class="nb">and </span><span class="ss">:random-int</span><span class="p">))</span>
</code></pre></div>


<p>But that's probably just greedy. </p>
<p>And so, to the final piece in the puzzle: how does <code>inject-cofx</code>
know what to do when it is given <code>:now</code> or <code>:local-store</code>?
Each <code>cofx-id</code> requires a different action.</p>
<h2 id="meet-reg-cofx">Meet <code>reg-cofx</code><a class="headerlink" href="#meet-reg-cofx" title="Permanent link">&para;</a></h2>
<p>This function is also part of the re-frame API.</p>
<p>It allows you to associate a <code>cofx-id</code> (like <code>:now</code> or <code>:local-store</code>) with a
handler function that injects the right key/value pair.</p>
<p>The function you register will be passed two arguments:</p>
<ul>
<li>a <code>:coeffects</code> map (to which it should add a key/value pair), and</li>
<li>optionally, the additional value supplied to <code>inject-cofx</code></li>
</ul>
<p>and it is expected to return a modified <code>:coeffects</code> map.</p>
<h2 id="example-of-reg-cofx">Example Of <code>reg-cofx</code><a class="headerlink" href="#example-of-reg-cofx" title="Permanent link">&para;</a></h2>
<p>Above, we wrote an event handler that wanted <code>:now</code> data to be available.  Here
is how a handler could be registered for <code>:now</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-cofx</span>               <span class="c1">;; registration function</span>
   <span class="ss">:now</span>                 <span class="c1">;; what cofx-id are we registering</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">coeffects</span> <span class="nv">_</span><span class="p">]</span>    <span class="c1">;; second parameter not used in this case</span>
      <span class="p">(</span><span class="nb">assoc </span><span class="nv">coeffects</span> <span class="ss">:now</span> <span class="p">(</span><span class="nf">js.Date.</span><span class="p">))))</span>   <span class="c1">;; add :now key, with value</span>
</code></pre></div>


<p>The outcome is:</p>
<ol>
<li>because that cofx handler above is now registered for <code>:now</code>, I can</li>
<li>add an Interceptor to an event handler which</li>
<li>looks like <code>(inject-cofx :now)</code></li>
<li>which means within that event handler I can access a <code>:now</code> value from <code>cofx</code></li>
</ol>
<p>As a result, my event handler is pure.</p>
<h2 id="another-example-of-reg-cofx">Another Example Of <code>reg-cofx</code><a class="headerlink" href="#another-example-of-reg-cofx" title="Permanent link">&para;</a></h2>
<p>This:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-cofx</span>               <span class="c1">;; new registration function</span>
   <span class="ss">:local-store</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">coeffects</span> <span class="nv">local-store-key</span><span class="p">]</span>
      <span class="p">(</span><span class="nb">assoc </span><span class="nv">coeffects</span>
             <span class="ss">:local-store</span>
             <span class="p">(</span><span class="nf">js-&gt;clj</span> <span class="p">(</span><span class="nf">.getItem</span> <span class="nv">js/localStorage</span> <span class="nv">local-store-key</span><span class="p">)))))</span>
</code></pre></div>


<p>With these two registrations in place, I could now use both <code>(inject-cofx :now)</code> and
<code>(inject-cofx :local-store "blah")</code> in an event handler's interceptor chain.</p>
<p>To put this another way:  I can't use <code>(inject-cofx :blah)</code> UNLESS I have previously
used <code>reg-cofx</code> to register a handler for <code>:blah</code>. Otherwise <code>inject-cofx</code> doesn't
know how to inject a <code>:blah</code>.</p>
<h2 id="secret-interceptors">Secret Interceptors<a class="headerlink" href="#secret-interceptors" title="Permanent link">&para;</a></h2>
<p>In a previous tutorial we learned that <code>reg-events-db</code>
and <code>reg-events-fx</code> add default interceptors to the front of the interceptor chain
specified during registration. We found they inserted an Interceptor called <code>do-fx</code>.</p>
<p>I can now reveal that
they also add <code>(inject-cofx :db)</code> at the front of each chain.</p>
<p>Guess what that injects into the <code>:coeffects</code> of every event handler? This is how <code>:db</code>
is always available to event handlers.</p>
<p>Okay, so that was the last surprise. Now you know everything.</p>
<p>If ever you wanted to use DataScript, instead of an atom-containing-a-map
like <code>app-db</code>, you'd replace <code>reg-event-db</code> and <code>reg-event-fx</code> with your own
registration functions and have them auto insert the DataScript connection.</p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>During testing, you may want to stub out certain coeffects.</p>
<p>You may, for example, want to test that an event handler works
using a specific <code>now</code>.</p>
<p>In your test, you'd mock out the cofx handler:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nf">reg-cofx</span>
   <span class="ss">:now</span>
   <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">coeffects</span> <span class="nv">_</span><span class="p">]</span>
      <span class="p">(</span><span class="nb">assoc </span><span class="nv">coeffects</span> <span class="ss">:now</span> <span class="p">(</span><span class="nf">js/Date.</span> <span class="mi">2016</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)))</span>   <span class="c1">;; then is `:now`</span>
</code></pre></div>


<p>If your test does alter registered coeffect handlers, and you are using <code>cljs.test</code>,
then you can use a <code>fixture</code> to restore all coeffects at the end of your test:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">defn </span><span class="nv">fixture-re-frame</span>
  <span class="p">[]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">restore-re-frame</span> <span class="p">(</span><span class="nf">atom</span> <span class="nv">nil</span><span class="p">)]</span>
    <span class="p">{</span><span class="ss">:before</span> <span class="o">#</span><span class="p">(</span><span class="nf">reset!</span> <span class="nv">restore-re-frame</span> <span class="p">(</span><span class="nf">re-frame.core/make-restore-fn</span><span class="p">))</span>
     <span class="ss">:after</span>  <span class="o">#</span><span class="p">(</span><span class="o">@</span><span class="nv">restore-re-frame</span><span class="p">)}))</span>

<span class="p">(</span><span class="nf">use-fixtures</span> <span class="ss">:each</span> <span class="p">(</span><span class="nf">fixture-re-frame</span><span class="p">))</span>
</code></pre></div>


<p><code>re-frame.core/make-restore-fn</code> creates a checkpoint for re-frame state (including
registered handlers) to which you can return.</p>
<h2 id="the-5-point-summary">The 5 Point Summary<a class="headerlink" href="#the-5-point-summary" title="Permanent link">&para;</a></h2>
<p>In note form:</p>
<ol>
<li>Event handlers should only source data from their arguments</li>
<li>We want to "inject" required data into the first, cofx argument</li>
<li>We use the <code>(inject-cofx :key)</code> interceptor in registration of the event handler</li>
<li>It will look up the registered cofx handler for that <code>:key</code> to do the injection</li>
<li>We must have previously registered a cofx handler via <code>reg-cofx</code></li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
    <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav
        class="md-footer-nav__inner md-grid"
        aria-label="Footer"
      >

        <!-- Link to previous page -->
        
          <a
            href="../Effects/"
            title="Effects"
            class="md-footer-nav__link md-footer-nav__link--prev"
            rel="prev"
          >
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Effects
              </div>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a
            href="../review-todomvc/"
            title="Review TodoMVC"
            class="md-footer-nav__link md-footer-nav__link--next"
            rel="next"
          >
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Review TodoMVC
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2015-2021 Michael Thompson
          </div>
        
      </div>

      <!-- Social links -->
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/day8" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/wazound" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
    <script src="/re-frame/js/docs.js"></script>

    </div>
    
      <script src="../assets/javascripts/vendor.df0def68.min.js"></script>
      <script src="../assets/javascripts/bundle.ba57d267.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>